# 创造 — 一句话，一个世界

> 每个人心里都有一个故事，我们让它 10 秒内变成可以玩的游戏。

---

## 为什么

**创作者的痛**：想做互动故事游戏？你需要会写代码、画 UI、部署服务器。99% 的好故事死在了"我不会编程"。

**玩家的痛**：AI 对话游戏要么千篇一律的恋爱模拟，要么没有 UI 的纯文本聊天。没人能说"我想玩太空歌剧"然后真的拿到一个。

**我们的位置**：AI 已能写出好故事，我们有 5 个验证过的 UI 骨架。在中间加一层——让 AI 把"一句话"翻译成"游戏配置"——就是全部。

---

## 用户是谁

| 类型 | 一句话画像 | 来这里干嘛 |
|------|----------|----------|
| 故事爱好者 | 脑子里有故事，手上没技术 | 把脑中的世界变成能玩的游戏 |
| 社交玩家 | 喜欢跟朋友角色扮演 | 快速创建主题游戏，发群里 |
| 内容创作者 | B站/小红书博主 | "一句话 AI 生成游戏"做选题 |
| 教育者 | 老师/培训师 | 创建互动式教学场景 |

---

# 一、完整用户动线

> 一个用户从打开网页到分享给朋友，完整走一遍是什么样的。

```
打开网页 → 输入一句话 → 等待生成 → 预览世界 → 进入游戏 →
对话互动 → 属性变化 → 完成目标 → 事件实时记录 → 遭遇重大事件 → 解锁角色 →
获得物品 → 高光时刻 → 存档离开 → 隔天继续 → 通关 → 分享给朋友 →
朋友打开链接 → 直接预览 → 开始自己的冒险
```

### 场景 1：打开网页

小明打开链接，看到一个暗色调的全屏页面。中间是一个发着柔光的输入框，上面写着"用一句话，描述你想玩的游戏"。输入框下方，灵感提示在缓缓滚动：

> 试试：一个发生在太空站的密室逃脱
> 试试：我变成西游记里的孙悟空
> 试试：古代武林，五大门派的恩怨情仇

小明想了想，打字："民国上海，我是一个潜伏在日本商会的地下党特工"。点击"创造世界"。

### 场景 2：等待生成

屏幕切换到加载界面。一个进度条缓缓推进，上方的文字在变化：

```
正在分析剧本…          12%
正在构思世界观…         30%
正在创造角色…           55%
正在布置场景…           72%
正在规划目标…           88%
正在调配色彩…           100%
```

大约 10 秒，进度条走满。

### 场景 3：预览世界

一张精美的世界卡片展开——

**暗夜谍影** — 谍战悬疑
> "民国十六年的上海，霓虹与暗影交织。你以商人身份潜伏在日本商会，每一步都踩在刀尖上。"

**角色**：四张卡片横排。苏晚棠（舞女）、陆远舟（记者）亮着；宋锦书（军官）、藤原（商人）是灰色剪影加"？"号——这两个角色要在剧情中才能遇见。

**目标**：
- **获取密电码** — 通过与苏晚棠建立信任，获取藤原保险箱位置，找机会潜入取出
- **识别组织内鬼** — 在四个角色中辨别谁在向日方泄露情报，收集至少三条证据
- **全身而退** — 完成任务后安全撤离上海，不暴露地下党身份

**你的属性**：忠诚 80 · 怀疑 20 · 情报 10

**主题色**：深金色 + 暗红（整个界面预览了这套配色）

小明觉得不错，点击"开始游戏"。

### 场景 4：进入游戏 — 开场叙事

三栏布局铺开。中栏的场景背景是一张老上海的百乐门夜景，带着 60% 的暗色遮罩。一封开场信缓缓出现——

> *民国十六年，深秋。法租界的梧桐树叶铺满了石板路。你以"新东洋商社"副经理的身份，已经潜伏了整整三年……*

左栏显示当前场景"百乐门"，苏晚棠的立绘正对着小明（她是默认对话角色）。右栏的三个目标都是 0%，关键事件和资产还是空的。

顶栏：🎭 暗夜谍影 · 回合 0 · 第1天·傍晚·百乐门

### 场景 5：第一次对话

开场信结束后，中栏底部出现了四个行动选项按钮：

```
🔍 观察百乐门里的每一个人
🗣 走向苏晚棠，低声问好
🍸 在吧台坐下，点一杯威士忌
📝 去洗手间，用暗号联系上线
```

小明点了"走向苏晚棠，低声问好"。

AI 开始流式输出——故事文字一段段浮现在对话区：

> 你整了整领带，穿过舞池。苏晚棠正靠在钢琴旁，手里转着一杯香槟。看到你走来，她嘴角微微一翘。
>
> "好久不见，副经理先生。今晚怎么有空来百乐门？"
>
> 她的声音很轻，但你注意到她的目光快速扫了一眼二楼的包厢——那里坐着藤原。
>
> 【忠诚 +5，情报 +10】

左栏的属性面板跳动了一下：忠诚从 80 变成了 85（绿色 +5 的小数字闪了一下），情报从 10 变成了 20。

然后新一轮的行动选项出现了。小明也可以无视这些选项，直接在输入框里打自己想说的话。

### 场景 6：目标推进

几轮对话后，苏晚棠透露了一个关键信息——密电码藏在藤原的保险箱里。AI 的回复中带了一行：

> 【目标更新：获取密电码 +20%】

右栏的"获取密电码"进度条从 0% 跳到了 20%，进度条动画流畅地填充了一截。小明点开这个目标卡片，看到达成条件："通过与苏晚棠建立信任关系，获取藤原保险箱的位置情报，并找到合适时机潜入取出密电码。"——保险箱位置已经知道了，接下来要找时机潜入，方向很清晰。

### 场景 7：事件实时记录

对话进行到第 5 回合，小明成功跟苏晚棠接上了头——她是组织安排在百乐门的另一条线。AI 回复的故事文本之外，悄悄带了一行：

> 【关键事件：接头成功】在百乐门后台，你与苏晚棠确认了彼此的身份。她是组织安排在上海的第二条情报线。

小明没有看到弹窗（这不是"重大事件"），但右栏的"关键事件"区域安静地多了一条记录：

```
┌───────────────────────────┐
│  ⚡ 关键事件          (1)  │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 接头成功        │   │
│  │                   │   │
│  │ ○ 回合 5          │   │
│  │                   │   │
│  │ 在百乐门后台，你与 │   │
│  │ 苏晚棠确认了彼此的 │   │
│  │ 身份。她是组织安排  │   │
│  │ 在上海的第二条情报  │   │
│  │ 线。              │   │
│  │                   │   │
│  │ 🏷 剧情           │   │
│  └───────────────────┘   │
│                           │
└───────────────────────────┘
```

继续玩了两回合。小明在法租界街道尾随藤原，发现他进了一家古董店。又一条事件悄然入列：

```
┌───────────────────────────┐
│  ⚡ 关键事件          (2)  │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 发现藤原密会地点 │   │  ← 最新的在上面
│  │ ○ 回合 7          │   │
│  │ 你跟踪藤原来到法租 │   │
│  │ 界一家古董店，他在  │   │
│  │ 此处与神秘人接头。  │   │
│  │ 🏷 发现           │   │
│  └───────────────────┘   │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 接头成功        │   │  ← 较早的在下面
│  │ ○ 回合 5          │   │
│  │ 在百乐门后台……    │   │
│  │ 🏷 剧情           │   │
│  └───────────────────┘   │
│                           │
└───────────────────────────┘
```

事件就这样一条条安静地积累。小明随时可以瞥一眼右栏，回顾"到目前为止我经历了什么"。这是他的冒险日记，由 AI 自动撰写。

### 场景 8：遭遇重大事件

又过了一回合，剧情到了一个转折——陆远舟突然出现在百乐门，他认出了小明的真实身份。这次不一样了，AI 输出的是 `【重大事件】` 标记。整个屏幕暗了下来，一个弹窗从中间浮现：

```
┌──────────────────────────────┐
│                              │
│   🚨 重大事件    🏷 剧情      │
│      ○ 回合 8                │
│                              │
│   身份暴露危机                │
│                              │
│   陆远舟——上海滩最有名的      │
│   记者，在百乐门认出了你的    │
│   真实身份。他手里拿着一张    │
│   三年前的照片……             │
│                              │
│   ┌────────────────────┐    │
│   │      继续          │    │
│   └────────────────────┘    │
│                              │
└──────────────────────────────┘
```

小明点击"继续"，弹窗关闭。这条事件也被记录到右栏时间线，但它有一个红色的 🚨 标记，区别于普通事件。

**普通事件 vs 重大事件**：
- 普通事件（回合 5、7）：安静地出现在右栏，不打断游戏节奏
- 重大事件（回合 8）：全屏弹窗打断，制造仪式感，然后也记录到右栏

### 场景 9：角色解锁

因为陆远舟的出现，AI 输出了：

> 【解锁角色：陆远舟】

左栏角色网格中，原本灰色的"？"位置亮了起来——陆远舟的头像出现了，伴随一个微妙的发光动画。小明现在可以切换到陆远舟进行对话了。

### 场景 10：获得物品

小明在和苏晚棠的深入对话中，她偷偷递给了小明一把钥匙：

> 【获得物品：百乐门后门钥匙 · 可进入 VIP 包厢】

右栏资产区新增了一张物品卡片。这把钥匙在后续剧情中可以使用。

### 场景 11：切换场景

小明点击左栏场景卡片的切换按钮，选择"法租界街道"。中栏的背景无缝切换为法租界的弄堂场景，可对话的角色也随之变化。

### 场景 12：高光时刻

一段特别精彩的对话后，小明注意到对话区边上有一个"✨"按钮。点击后弹出高光分析面板——AI 快速分析了这段对话的情感张力，然后提供风格选择（电影感/水墨/插画……），小明选了"电影感"，AI 生成了一张这个场景的图片。

### 场景 13：存档离开

玩了半小时，小明需要出门。点击顶栏"存档"按钮，看到"已保存"的提示。关闭浏览器。

### 场景 14：隔天继续

第二天，小明打开同一个链接。页面检测到本地有存档，弹窗问："发现上次的冒险，是否继续？"小明点继续，游戏恢复到离开时的状态——同样的对话记录、属性值、目标进度、已触发的事件。

### 场景 15：通关

经过多日游玩，小明完成了三个目标（全部 100%），触发了结局叙事。一段完整的结局信展开，然后出现结算画面——列出所有完成的目标、解锁的角色、经历的关键事件、最终属性值。

### 场景 16：分享

结算画面上有一个"分享这个世界"按钮。小明点击后获得一个链接。他把链接发到群里："我做了一个民国谍战游戏，你们来试试。"

### 场景 17：朋友打开

小红点开链接，直接看到"暗夜谍影"的世界预览——角色、目标、属性一目了然。她点"开始游戏"，进入了同一个世界，但属于她自己的冒险。相同的开局，完全不同的故事走向。

---

# 二、功能用户故事

> 每个功能对应一个用户期望。没有用户故事的功能不该存在。

### F1 创造终端

**用户故事**：我打开网页，想快速开始。我不想注册，不想学怎么用，就想说一句话，然后看到魔法发生。

**触发**：用户首次打开页面
**结束**：用户点击"创造世界"

**用户看到的**：
- 全屏暗色背景，中央一个带柔光效果的文本输入框
- 占位文字："用一句话，描述你想玩的游戏"
- 输入框下方有缓缓滚动的灵感提示（3-5 条轮播）
- 右下角字数统计（0/2000）
- 一个"创造世界"大按钮

**用户能做的**：
- 打字输入任意长度描述（1字-2000字都行）
- 点击灵感提示，自动填入输入框
- 按回车或点按钮提交

---

### F2 世界生成加载

**用户故事**：我点了创造之后，我需要知道它在工作，不是卡死了。而且这个等待过程本身应该让我期待。

**触发**：用户点击"创造世界"
**结束**：生成完成，自动跳转预览

**用户看到的**：
- 全屏加载界面
- 中央进度条，0% → 100%
- 进度条上方的阶段文字依次变化（6 个阶段，见下方）
- 整体氛围感：粒子动画 / 文字渐变 / 微妙的光效

**阶段文字**：
1. "正在分析剧本…"
2. "正在构思世界观…"
3. "正在创造角色…"
4. "正在布置场景…"
5. "正在规划目标…"
6. "正在调配色彩…"

---

### F3 世界预览

**用户故事**：AI 生成完了，我想先看看这个世界长什么样。如果不满意，我可以重新生成一个。

**触发**：世界生成完成
**结束**：用户点击"开始游戏"或"重新生成"

**用户看到的**：
- 游戏名称 + 类型标签
- 一段沉浸式的世界描述
- 角色卡片横排（亮色=可用，灰色=待解锁）
- 场景列表（名称+图标）
- 目标列表（3-4 条）
- 玩家属性预览（名称+初始值）
- 主题配色预览
- 两个按钮："开始游戏"、"重新生成"

**用户能做的**：
- 浏览生成结果
- 点"重新生成"→ 保留原始输入，生成一个全新的世界
- 点"开始游戏"→ 进入游玩

---

### F4 对话引擎

**用户故事**：我进入游戏后，想通过对话推进故事。AI 的回复应该像小说一样好看，一段一段出现，不是一整坨。

**触发**：用户发送消息（打字或点选项）
**结束**：AI 回复完成，新一轮选项出现

**用户看到的**：
- 中栏铺满场景背景图（带暗色遮罩保证文字可读）
- 故事文本以 Chat Fiction 风格逐段出现（流式显示）
- 角色对话有名字标识
- 数值变化标记 `【忠诚 -5】` 内联在文本中，用彩色高亮
- 底部输入框，随时可以打字

**用户能做的**：
- 阅读 AI 生成的故事文本
- 在输入框中自由打字（任何内容都行）
- 点击行动选项（见 F5）

---

### F5 行动选项

**用户故事**：我不想每次都绞尽脑汁想该说什么。给我几个选择，我点一个就行。但如果我有自己的想法，我也想自己打字。

**触发**：每次 AI 回复完成后
**结束**：用户选择一个选项或自己输入

**用户看到的**：
- 输入框上方出现 3-4 个按钮，每个按钮是一个建议行动
- 有一个"展开/折叠"切换（默认展开）
- 按钮有 icon 前缀（🔍 🗣 🍸 📝 等）

**用户能做的**：
- 点击任意选项 → 直接作为消息发送
- 折叠选项面板，自己在输入框中打字
- 两者等价，只是选项降低了输入门槛

**消失时机**：
- 用户选了一个选项后，选项面板消失
- 用户自己打字发送后，选项面板也消失
- 下一轮 AI 回复后，新的选项出现

---

### F6 玩家属性

**用户故事**：我想知道我的角色现在什么状态——我的忠诚度高不高？情报够不够？每次对话后我能看到变化。

**触发**：游戏开始时初始化；每次 AI 回复中包含属性变化标记时更新
**持续**：整个游戏过程

**用户看到的**（PC 左栏底部）：
- 区域标题："⚔ 属性"
- 每个属性一行：emoji图标 + 属性名 + 当前数值 + 进度条
- 变化时：数值旁闪现 `+5` 或 `-5` 的彩色小字，配合进度条动画
- 属性条颜色由配置决定（不同游戏不同色系）

**用户看到的**（手机端）：
- 在角色面板 Sheet 中，角色信息下方

**属性数量**：3-6 个，由 AI 根据游戏类型自动决定

**示例**：
| 游戏类型 | 属性维度 |
|---------|---------|
| 谍战 | 忠诚 · 怀疑 · 情报 |
| 恋爱 | 魅力 · 心动 · 好感 |
| 冒险 | 生命值 · 法力值 · 力量 · 智慧 |
| 武侠 | 内力 · 轻功 · 剑法 · 名望 |

---

### F7 角色系统

**用户故事**：我想跟不同的角色对话，了解他们的故事。有些角色一开始见不到，随着剧情推进才出现——这种发现感很棒。

**触发**：游戏开始时加载角色；剧情中解锁新角色
**持续**：整个游戏过程

**用户看到的**（PC 左栏）：
- 当前对话角色的大头像/立绘/视频（视觉主焦点）
- 角色名 + 身份标签
- 下方 2x2 角色选择网格
  - 已解锁：彩色头像，可点击
  - 未解锁：灰色"？"剪影，不可点击，hover 提示"随剧情解锁"

**用户能做的**：
- 点击已解锁的角色 → 切换对话对象
- 看到解锁动画（"？"变成角色头像，发光效果）

**解锁时机**：
- AI 在故事中提到新角色出场时，输出 `【解锁角色：角色名】`
- 前端播放解锁动画 + 通知

---

### F8 场景系统

**用户故事**：我想去不同的地方探索。换个场景，故事的氛围应该完全不同。

**触发**：用户主动切换场景
**持续**：整个游戏过程

**用户看到的**（PC 左栏顶部）：
- 场景卡片：场景名 + emoji 图标 + 一句描述
- 点击可切换到其他场景

**场景切换时发生的事**：
- 中栏背景图/视频切换（无缝过渡）
- 角色网格更新（不同场景有不同角色）
- 消耗行动力

**用户看到的**（中栏）：
- 场景背景图铺满中栏（带 60% 遮罩）
- 有背景视频时自动播放

---

### F9 目标系统

**用户故事**：我需要知道"这个游戏让我干嘛"和"我要怎么做才能完成"。光说"获取密电码"没用，得告诉我路径——"通过和苏晚棠建立信任获取保险箱位置，再潜入藤原办公室"。

**触发**：游戏开始时加载初始目标；AI 自动推进进度
**持续**：整个游戏过程

**用户看到的**（PC 右栏顶部）：
- 区域标题："📋 目标 (N)"，N 是未完成数量
- 每个目标卡片：
  - 圆形状态图标（○ 进行中 / ◉ 已完成）
  - **目标标题**（大字，如"获取密电码"）
  - **达成条件**（灰色小字，说明你需要做什么才能推进这个目标）
  - 进度条 0-100%
  - 百分比数字

**达成条件是什么**：
- 每个目标下面有一段文字，告诉玩家**完成这个目标的路径/方法**
- 例：目标"完成八十一难"→ 条件"作为穿越者，你需要以孙悟空的身份经历九九八十一难，保护唐僧西天取经，最终修成正果。"
- 例：目标"获取密电码"→ 条件"通过与苏晚棠建立信任关系，获取藤原保险箱的位置情报，并找到合适时机潜入取出密电码。"
- 这段文字由 AI 在生成世界时一并生成，给玩家方向感

**目标进度如何变化**：
- AI 在每次回复中判断：这段对话是否让某个目标有了进展？
- 如果有，输出 `【目标更新：目标名 +20%】`
- 前端解析后，进度条动画推进
- 达到 100% → 目标标记为已完成（绿色 ✓）

**用户看到的**（手机端）：
- 底部图标栏点"📋"→ Sheet 弹出，展示目标列表（标题+条件+进度条）

---

### F10 关键事件

**用户故事**：玩了十几个回合，我想回顾一下"到目前为止发生了什么"。一条时间线，列出所有重要的事件，就像自动撰写的冒险日记——我不用自己记，系统帮我记。

**触发**：AI 判断发生了有意义的剧情节点时（平均每 2-3 回合产生一条）
**持续**：累积到游戏结束

**用户看到的**（PC 右栏中部）：

```
┌───────────────────────────┐
│  ⚡ 关键事件          (4)  │
│                           │
│  ┌───────────────────┐   │
│  │ 🚨 身份暴露危机    │   │ ← 重大事件，红色标记
│  │ ○ 回合 8          │   │
│  │ 陆远舟在百乐门认出 │   │
│  │ 了你的真实身份……  │   │
│  │ 🏷 剧情           │   │
│  └───────────────────┘   │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 发现藤原密会地点 │   │ ← 普通事件
│  │ ○ 回合 7          │   │
│  │ 跟踪藤原来到法租界 │   │
│  │ 一家古董店……      │   │
│  │ 🏷 发现           │   │
│  └───────────────────┘   │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 接头成功        │   │
│  │ ○ 回合 5          │   │
│  │ 与苏晚棠确认了彼此 │   │
│  │ 的身份……          │   │
│  │ 🏷 剧情           │   │
│  └───────────────────┘   │
│                           │
│  ┌───────────────────┐   │
│  │ 📋 抵达百乐门      │   │
│  │ ○ 回合 1          │   │
│  │ 以商人身份走进百乐 │   │
│  │ 门，开始今夜的行动 │   │
│  │ 🏷 剧情           │   │
│  └───────────────────┘   │
│                           │
└───────────────────────────┘
```

**每条事件卡片包含**：
- **图标**：📋 普通事件 / 🚨 重大事件（重大事件视觉上更醒目）
- **事件标题**：一句话概括发生了什么
- **回合标记**：发生在第几回合
- **事件摘要**：1-2 句话描述细节（默认显示前两行，点击展开全部）
- **标签**：标注事件类型（剧情 / 战斗 / 发现 / 社交），不同标签不同颜色

**排列规则**：最新的在最上面，往下翻是越来越早的事件。

**事件如何产生**：
- AI 在每次回复中判断：这段对话是否达成了一个有意义的节点？
- 如果是普通节点，输出 `【关键事件：事件标题】事件描述`
- 如果是重大转折，输出 `【重大事件：事件标题】事件描述`（额外触发 F11 弹窗）
- 前端解析后，新事件卡片以淡入动画添加到右栏时间线顶部

**用户看到的**（手机端）：
- 底部图标栏点"⚡"→ Sheet 从底部弹出，展示完整事件时间线
- 样式与 PC 端一致，卡片纵向排列

---

### F11 重大事件弹窗

**用户故事**：故事到了关键转折点——身份暴露、重要角色死亡、大决战——这种时刻应该有仪式感，不能悄悄混过去。

**触发**：AI 输出带 `重大` 标记的关键事件
**结束**：用户点击关闭按钮

**用户看到的**：
- 全屏半透明遮罩
- 居中弹窗卡片，从下方滑入
  - 🚨 "重大事件" + 标签（剧情/战斗/发现）
  - 回合标记
  - 事件标题（大字）
  - 事件描述（2-3 句话）
  - 关闭按钮（文案可配置，如"继续"、"朕知道了"）
- 关闭后，事件记录到右栏时间线

**与高光时刻的区别**：
| | 重大事件弹窗 | 高光时刻 |
|--|------------|---------|
| 触发方式 | AI 自动 | 用户手动 |
| 内容 | 剧情里程碑文字 | AI 分析 + 生成图片/视频 |
| 频率 | 每 5-10 回合一次 | 用户随时可触发 |

---

### F12 资产系统

**用户故事**：对话中获得了一把钥匙、一瓶毒药、一封密信——这些东西应该存起来，我随时能看到自己有什么，关键时刻能用上。

**触发**：AI 在回复中授予物品时
**持续**：累积到游戏结束

**用户看到的**（PC 右栏底部）：
- 区域标题："🎒 资产 (N)"
- 物品卡片列表：
  - emoji 图标 + 物品名
  - 一句效果描述（"攻击力+50"、"可打开 VIP 包厢"）
- 空状态："暂无资产"

**物品如何获得**：
- AI 输出 `【获得物品：物品名 · 效果描述】`
- 前端解析后，右栏资产区新增一张卡片
- 入场动画：卡片淡入+微弹

**物品如何使用**：
- 部分物品可对角色使用（点击物品 → 选择角色 → 应用效果）
- 效果影响玩家属性或角色关系
- 使用后物品可能消失（一次性）或保留（永久）

---

### F13 高光时刻

**用户故事**：这段对话太精彩了，我想把它变成一张图或一段视频，保存下来，或者发朋友圈。

**触发**：用户点击对话区的"✨"按钮
**结束**：图片/视频生成完成

**流程**：
1. 点击"✨"→ 弹出分析面板
2. AI 快速分析最近几段对话的情感和画面感
3. 用户选择风格（电影感 / 水墨 / 赛博朋克 / 二次元 等）
4. AI 生成图片（~10秒）或视频（~30秒）
5. 结果展示，可下载/分享

---

### F14 存档系统

**用户故事**：我玩到一半要出门，回来的时候必须能从断点继续。不能让我重新开始。

**触发**：用户手动存档 / 每回合自动存档
**持续**：跨浏览器会话

**用户看到的**：
- 顶栏"存档"按钮 → 点击后显示"已保存 ✓"
- 重新打开页面 → 弹窗："发现上次的冒险，是否继续？"
- 选"继续"→ 恢复全部状态
- 选"新游戏"→ 重置（旧存档可选保留）

**保存内容**：
- 全部对话记录
- 当前天数/时段/回合/场景
- 玩家属性
- 角色关系属性
- 目标进度
- 关键事件列表
- 已解锁角色
- 资产/物品

**存储方式**：浏览器 localStorage，key 为 `chuangzhao-save-v2`（v2 含 WorldConfig）

---

### F15 分享系统

**用户故事**：我创造了一个超酷的游戏世界，我想让朋友也来玩。发一个链接，他打开就能直接看到这个世界。

**触发**：用户点击"分享"按钮
**结束**：获得可分享的 URL

**用户看到的**：
- 点击分享 → 生成一个 URL → 可复制
- URL 里编码了完整的世界配置（角色/场景/目标/属性/主题色）
- 不包含游戏进度（朋友从头开始自己的冒险）

**朋友看到的**：
- 打开链接 → 直接看到世界预览页面（跳过创造和加载）
- 点"开始游戏"→ 进入同一个世界，开始自己的故事

**技术方式**：世界配置 JSON → lz-string 压缩 → URL-safe 编码 → `?w=` 参数。约 2-4KB，不需要服务端存储。

---

### F16 时段与天数

**用户故事**：我希望游戏里有时间流逝的感觉。白天和晚上的氛围不同，我的行动力是有限的——不能在一天里做无限多的事。

**触发**：每次消耗行动力
**持续**：整个游戏过程

**用户看到的**：
- 顶栏显示：第N天 · 时段名 · 场景名
- 每次行动（对话/使用物品/切换场景）消耗行动力
- 行动力耗尽 → 时段推进（清晨→上午→午后→…→深夜）
- 所有时段走完 → 新的一天，行动力重置

---

# 三、功能数据规格

> 每个功能需要什么数据字段，一览无余。

### F1 创造终端

| 字段 | 类型 | 说明 |
|------|------|------|
| `prompt` | string | 用户输入的描述，1-2000 字 |
| `inspirations` | string[] | 灵感提示列表，轮播展示 |

---

### F2 世界生成加载

| 字段 | 类型 | 说明 |
|------|------|------|
| `progress` | number | 0-100 进度百分比 |
| `currentStage` | string | 当前阶段文字 |
| `stages` | string[] | 6 个阶段文字列表 |

---

### F3 世界预览

预览页面展示的是 AI 生成的完整 `WorldConfig`，结构如下：

| 字段 | 类型 | 说明 |
|------|------|------|
| `title` | string | 游戏名称，如"暗夜谍影" |
| `genre` | string | 类型标签，如"谍战悬疑" |
| `description` | string | 世界描述/开场白 |
| `icon` | string | emoji 图标 |
| `themeColors` | object | 主题配色（primary/accent/bg 等） |
| `characters` | Character[] | 角色列表 |
| `scenes` | Scene[] | 场景列表 |
| `goals` | Goal[] | 初始目标 |
| `playerStats` | StatConfig[] | 玩家属性配置 |
| `characterStats` | StatConfig[] | 角色关系属性配置 |
| `periods` | TimePeriod[] | 时段列表 |
| `items` | GameItem[] | 初始物品（可选） |
| `maxDays` | number | 最大游戏天数 |
| `maxActionPoints` | number | 每日行动力 |
| `narrativeStyle` | string | AI 叙事风格描述 |

---

### F4 对话引擎

| 字段 | 类型 | 说明 |
|------|------|------|
| `messages` | Message[] | 全部对话记录 |
| `messages[].role` | 'user' \| 'assistant' \| 'system' | 消息角色 |
| `messages[].content` | string | 消息内容 |
| `messages[].characterId` | string? | 关联的 NPC ID |
| `isStreaming` | boolean | 是否正在流式输出 |
| `currentCharacter` | string \| null | 当前对话角色 ID |

---

### F5 行动选项

| 字段 | 类型 | 说明 |
|------|------|------|
| `currentActions` | string[] | 当前 3-4 个建议行动文本 |
| `actionsExpanded` | boolean | 选项面板是否展开 |

**AI 输出格式**：`【行动选项】1. 选项文本 2. 选项文本 3. 选项文本`

---

### F6 玩家属性

**配置层**（AI 生成 / config 定义）：

| 字段 | 类型 | 说明 |
|------|------|------|
| `playerStats[].name` | string | 属性显示名，如"忠诚" |
| `playerStats[].aliases` | string[] | AI 输出别名，如["忠诚度","忠诚值"] |
| `playerStats[].color` | string | 进度条/标签颜色 |
| `playerStats[].icon` | string? | emoji 图标 |

**运行时状态**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `playerStatValues` | Record\<string, number\> | 当前值，如 {忠诚: 85, 情报: 20} |

**AI 输出格式**：`【忠诚 -5，情报 +10】`（与现有数值解析格式一致）

---

### F7 角色系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `characters[].id` | string | 唯一标识 |
| `characters[].name` | string | 显示名 |
| `characters[].avatar` | string | emoji 或单字头像 |
| `characters[].title` | string | 身份标签，如"舞女" |
| `characters[].themeColor` | string | 主题色 hex |
| `characters[].description` | string | 性格简介 |
| `characters[].image` | string? | 立绘图路径 |
| `characters[].video` | string? | 动态视频路径 |
| `characters[].locked` | boolean | 是否初始锁定 |
| `characters[].initialStats` | Record\<string, number\> | 与玩家的初始关系值 |

**运行时**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `unlockedCharacters` | Set\<string\> | 已解锁角色 ID 集合 |
| `characterStatValues` | Record\<string, Record\<string, number\>\> | 各角色当前关系值 |

**AI 输出格式**：`【解锁角色：角色名】`

---

### F8 场景系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `scenes[].id` | string | 唯一标识 |
| `scenes[].name` | string | 场景名 |
| `scenes[].icon` | string | emoji 图标 |
| `scenes[].description` | string | 一句话描述 |
| `scenes[].background` | string | 背景图路径 |
| `scenes[].backgroundVideo` | string? | 背景视频路径 |
| `scenes[].characters` | string[] | 该场景可遇到的角色 ID |

**运行时**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `currentScene` | string | 当前场景 ID |

---

### F9 目标系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `goals[].id` | string | 唯一标识 |
| `goals[].title` | string | 目标名称，如"获取密电码" |
| `goals[].condition` | string | 达成条件——告诉玩家怎样才能完成这个目标 |
| `goals[].progress` | number | 0-100 百分比 |
| `goals[].completed` | boolean | 是否已完成 |

**示例**：
```
{
  id: "get-code",
  title: "获取密电码",
  condition: "通过与苏晚棠建立信任关系，获取藤原保险箱的位置情报，并找到合适时机潜入取出密电码。",
  progress: 0,
  completed: false
}
```

**AI 输出格式**：`【目标更新：目标标题 +20%】`

---

### F10 关键事件

| 字段 | 类型 | 说明 |
|------|------|------|
| `keyEvents[].id` | string | 唯一标识 |
| `keyEvents[].title` | string | 事件标题 |
| `keyEvents[].description` | string | 事件描述 |
| `keyEvents[].round` | number | 发生在第几回合 |
| `keyEvents[].tags` | string[] | 标签，如 ["剧情"]、["战斗"] |
| `keyEvents[].major` | boolean | 是否为重大事件（触发弹窗） |

**AI 输出格式**：
- 普通事件：`【关键事件：事件标题】事件描述`
- 重大事件：`【重大事件：事件标题】事件描述`

---

### F11 重大事件弹窗

复用 F10 的数据结构。当 `keyEvent.major === true` 时，除了记录到时间线，额外弹出全屏弹窗。

| 字段 | 类型 | 说明 |
|------|------|------|
| `pendingMajorEvent` | KeyEvent \| null | 待展示的重大事件 |
| `showEventModal` | boolean | 弹窗是否显示 |

---

### F12 资产系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `assets[].id` | string | 唯一标识 |
| `assets[].name` | string | 物品名 |
| `assets[].icon` | string | emoji 图标 |
| `assets[].description` | string | 效果描述 |
| `assets[].type` | string | 类别，如"武器"、"钥匙"、"药品" |
| `assets[].effects` | Record\<string, number\>? | 对玩家属性的影响 |
| `assets[].consumable` | boolean | 使用后是否消失 |

**AI 输出格式**：`【获得物品：物品名 · 效果描述】`

---

### F13 高光时刻

| 字段 | 类型 | 说明 |
|------|------|------|
| `highlightPhase` | 'idle' \| 'analyzing' \| 'style' \| 'generating' \| 'done' | 当前阶段 |
| `highlightContent` | string | 被分析的对话内容 |
| `selectedStyle` | string | 用户选择的图片风格 |
| `generatedImageUrl` | string? | 生成的图片 URL |
| `generatedVideoUrl` | string? | 生成的视频 URL |

---

### F14 存档系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `saveKey` | string | localStorage 键名 `{gameId}-save-v1` |
| `saveData` | object | 序列化的完整游戏状态 |
| `hasSave` | boolean | 是否有存档 |

**存档内容 = 全部运行时状态的快照**（对话记录 + 属性值 + 目标进度 + 事件列表 + 已解锁角色 + 资产 + 天数/时段/回合）

---

### F15 分享系统

| 字段 | 类型 | 说明 |
|------|------|------|
| `shareUrl` | string | 生成的分享链接 |
| `worldConfig` | WorldConfig | 压缩编码的世界配置 |

**分享内容 = WorldConfig**（不含游戏进度）
**编码方式**：JSON → lz-string compressToEncodedURIComponent → URL 参数 `?w=`

---

### F16 时段与天数

| 字段 | 类型 | 说明 |
|------|------|------|
| `currentDay` | number | 当前天数（从 1 开始） |
| `currentPeriod` | number | 当前时段索引 |
| `actionPoints` | number | 剩余行动力 |
| `maxActionPoints` | number | 每日行动力上限 |
| `round` | number | 总回合计数器 |
| `periods[].name` | string | 时段名，如"清晨" |
| `periods[].icon` | string | emoji 图标 |
| `periods[].hours` | string | 时间段，如"06:00-08:00" |

---

# 四、AI 结构化标记汇总

AI 在每次回复中，除了故事文本，还会输出以下标记。前端统一解析，分发到各个面板。

| 标记格式 | 触发功能 | 示例 |
|---------|---------|------|
| `【属性名 +/-N】` | F6 玩家属性更新 | `【忠诚 -5，情报 +10】` |
| `【目标更新：标题 +N%】` | F9 目标进度推进 | `【目标更新：获取密电码 +20%】` |
| `【关键事件：标题】描述` | F10 事件记录 | `【关键事件：密会被发现】你在码头的接头被人跟踪` |
| `【重大事件：标题】描述` | F11 事件弹窗 + F10 记录 | `【重大事件：身份暴露】陆远舟认出了你` |
| `【解锁角色：名字】` | F7 角色解锁 | `【解锁角色：宋锦书】` |
| `【获得物品：名字 · 描述】` | F12 资产新增 | `【获得物品：后门钥匙 · 可进入VIP包厢】` |
| `【行动选项】1. A 2. B 3. C` | F5 行动选项更新 | `【行动选项】1. 追上去 2. 假装没看见 3. 通知同伴` |

**解析规则**：
- 所有标记用中文全角方括号 `【】` 包裹
- 标记从对话文本中提取后，**对话流中不显示**（属性变化除外，它内联高亮）
- 一条 AI 回复中可以包含多个标记
- 标记不存在时静默忽略，不影响游戏

---

# 五、差异化

| 能力 | 纯文本 AI 聊天 | MOKU | 我们 |
|------|---------------|------|------|
| 场景视觉 | ❌ | ❌ 无背景图 | ✅ 背景图+视频 |
| 角色视觉 | ❌ | ❌ 文字头像 | ✅ 立绘+视频 |
| 对话体验 | 纯文本 | 长段叙事 | Chat Fiction 风格 |
| 游戏状态面板 | ❌ | ✅ | ✅ |
| 高光时刻 | ❌ | ❌ | ✅ AI 生图/视频 |
| 一句话创造 | ❌ | ✅ | ✅ |
| 链接分享 | ❌ | ❌ | ✅ 纯前端 |

**我们 = MOKU 的游戏深度 + 视觉小说的沉浸感 + AI 生成的便捷性**

---

# 六、MVP 边界

### 做

| 功能 | 对应 |
|------|------|
| 一句话创造 | F1 + F2 |
| 世界预览 | F3 |
| 三栏游戏界面 | F4-F12 全部 |
| 存档读档 | F14 |
| 分享链接 | F15 |

### 不做（后续迭代）

| 功能 | 原因 |
|------|------|
| AI 角色立绘 | emoji 头像先够用 |
| AI 场景背景图 | 纯色/渐变先够用 |
| AI 配乐 | 默认 BGM |
| 用户账号 | 纯前端先跑通 |
| 多人同玩 | 先做单人 |
| 编辑已生成世界 | 后续加 |

---

# 七、项目节奏

| 阶段 | 内容 | 交付物 | 状态 |
|------|------|--------|------|
| Phase 0 | 通用游戏 UI 模板 | config 驱动的三栏布局 + 全部游戏面板 | ✅ 完成 |
| Phase 1 | AI 世界生成器 + 创造流 + 分享 | 一句话→可玩游戏的完整体验 + URL 分享 | ✅ 完成 |
| Phase 2 | 灵感广场 + 社区 | 创造→分享→玩→更多人创造 | 规划中 |
| Phase 3 | AI 生图（角色/场景）+ 编辑器 | 视觉升级 + 用户可微调世界 | 规划中 |

## 当前实现状态

### Phase 0 — 通用游戏骨架 ✅

- 暗色 Indigo 三栏布局（PC）+ 移动端自适应
- config/ 驱动：修改 6 个配置文件即可换皮
- 对话引擎：SSE 流式输出 + Chat Fiction 风格
- 7 种 AI 结构化标记解析（属性/目标/事件/角色/物品/行动/重大事件）
- 存档系统 v2（含 WorldConfig）
- gx- CSS 前缀，CSS 变量主题系统

### Phase 1 — AI 创造流 ✅

- **创造终端**（creation-terminal.tsx）：全屏输入 + 7 条灵感提示 + 创造按钮
- **加载动画**（loading-screen.tsx）：6 阶段模拟进度条，API 返回跳 100%
- **世界预览**（world-preview.tsx）：WorldConfig 全字段展示，确认/重新生成/分享
- **AI 生成器**（generator.ts）：调用 Gemini Flash 生成 WorldConfig，含自动重试
- **分享系统**（share.ts）：lz-string 压缩 → URL ?w= 参数，纯前端零服务端
- **动态注入**：store._worldConfig + cfg() 闭包 + applyThemeColors() CSS 变量覆盖
- **App 状态机**：creation → loading → preview → game 四阶段
- **存档恢复**：创造页底部"继续上次游戏"按钮

### Phase 2 — 待规划

可能方向：
- 灵感广场：热门世界展示，一键体验
- 世界编辑器：用户微调 AI 生成的配置
- 结局系统：三目标全部完成 → 结算画面
- 多存档槽位：同时保存多个世界

### 技术栈

```
前端:    React 19 + Zustand + Immer + Framer Motion + Tailwind CSS v4
构建:    Vite 7 + TypeScript
AI:      Gemini 2.0 Flash (via api.yooho.ai)
分享:    lz-string 压缩编码
部署:    Cloudflare Pages + Workers
```
